# 项目架构升级分析报告：OCR 方案选型与重构建议

## 1. 现状痛点分析
当前 LegalExtractor 采用 **Wails (Go) + 本地 Python (RapidOCR)** 的架构，虽然保证了数据隐私和离线可用性，但也面临着显著的瓶颈：

*   **⚠️ 软件体积臃肿**：由于打包了完整的 Python 运行时、ONNX Runtime 引擎及 OpenCV 库，安装包体积高达 200MB+，分发困难。
*   **⚠️ 识别精度瓶颈**：面对复杂的扫描版法律文书（如倾斜、印章遮挡、多栏排版），本地 OCR 引擎在缺乏深度版面分析的情况下，容易出现文字乱序、水印干扰等问题，导致字段提取失败。
*   **⚠️ 维护成本高**：需要同时维护 Go 和 Python 两套环境，且需处理 Python 虚拟环境打包、依赖冲突及跨平台兼容性问题。

## 2. 百度 AI API 选型评估
经过对百度 AI 提供的三个 OCR 相关 API（PP-OCRv5, PP-StructureV3, PaddleOCR-VL）的深入对比分析，结论如下：

**🏆 推荐方案：PP-StructureV3 (智能文档分析)**

| 核心优势 | 解决的具体问题 |
| :--- | :--- |
| **版面分析 (Layout Analysis)** | 能够识别文档结构（标题、段落、表格），按人类阅读顺序输出 Markdown，彻底解决**扫描件文字乱序**问题。 |
| **印章检测与去除** | 原生支持印章识别，能够将印章内容与正文分离，从源头上解决**“电子签章”混入正文**导致的乱码问题。 |
| **表格还原** | 能精确还原法律文书中的表格结构，不再需要编写复杂的正则去拼凑表格数据。 |
| **Markdown 输出** | 直接返回结构化文本，极大地简化了后处理逻辑，降低了正则匹配的复杂度。 |

*注：PP-OCRv5 仅提供纯文字坐标，无法解决版面乱序；PaddleOCR-VL 虽然强大但输出不可控性较高，且成本可能更高。*

## 3. 新架构方案：云端 API 轻量化架构

若采纳 PP-StructureV3 方案，我们将对 LegalExtractor 进行彻底的架构重构，实现 **"去 Python 化"**。

### 🏗️ 架构对比

#### 旧架构 (Current)
*   **前端**：Vue 3
*   **后端**：Go (Wails)
*   **OCR 核心**：`os/exec` 调用 -> Python 子进程 -> RapidOCR (ONNX)
*   **体积**：~200MB
*   **流程**：PDF -> 图片 -> OCR -> 文本流 -> 正则提取

#### 新架构 (Proposed)
*   **前端**：Vue 3 (保持不变)
*   **后端**：Go (Wails)
*   **OCR 核心**：Go `net/http` -> **百度 AI Open API**
*   **体积**：**< 20MB** (缩减 90%+)
*   **流程**：PDF -> 上传云端 -> 获取 JSON/Markdown -> 解析结构化数据

### 🛠️ 重构实施路线图

1.  **清理阶段**
    *   删除 `internal/extractor/bridge_bin` 目录及所有 Python 代码。
    *   删除 `pdf_bridge.py`。
    *   移除 `Makefile` 和 CI/CD 流程中关于 Python 环境构建的步骤。

2.  **开发阶段**
    *   **配置管理**：在 `ConfigPanel` 增加 API Key 配置入口（支持用户输入自己的百度 API Key）。
    *   **API 客户端**：在 Go 中封装 `BaiduOCRClient`，实现鉴权、文件上传（Base64/File）及结果轮询。
    *   **解析引擎**：编写新的 `ParseStructureResponse` 函数，专门处理百度返回的 Markdown/JSON 数据，将其映射为 `ExtractResult`。

3.  **合规与隐私**
    *   在软件界面显著位置增加隐私提示：“使用云端识别模式，文件将被上传至百度 AI 服务器处理”。
    *   （可选）保留一个极简的 Go 原生 OCR 方案（如调用系统 OCR）作为离线兜底，但仅限纯文本 PDF。

### 📝 决策建议
此方案的核心权衡在于 **"隐私 vs 便利"**。如果您的目标用户群体（如律所、公司法务）允许将脱敏后的文档或非绝密文档上传至百度云端处理，那么**强烈建议切换至此新架构**。它将带来软件体积的质变和识别准确率的大幅提升。
